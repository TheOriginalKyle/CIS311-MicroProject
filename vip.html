<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Bootstrap Example</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Bootstrap 4 CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.2/css/bootstrap.min.css" integrity="sha384-PsH8R72JQ3SOdhVi3uxftmaW6Vc51MKb0q5P2rRUpPvrszuE4W1povHYgTpBfshb" crossorigin="anonymous">

    <!-- navmenu source -->
    <script src="./nav.js"></script>

    <!-- can't be shoved in nav.js cause weird stuff happens -->
    <script src="https://sdk.amazonaws.com/js/aws-sdk-2.2.18.min.js"></script>
    <script src="./aws-cognito-sdk.min.js"></script>

    <script src="./amazon-cognito-identity.min.js"></script>


  </head>
  <body>
    <script>dependencies()</script>

    <!-- create navigation menu -->
    <script>nav()</script>
    <!-- Modify's navigation menu to set current page to active -->
    <script>document.getElementById("vipPg").setAttribute("class", "nav-link active")</script>

    <div class="jumbotron jumbotron-fluid">
      <div class="container">
        <form id="form-div">
          <div class="form-group" id="unameDiv">
            <label for="uname" id="unameLbl">Username</label>
            <div class="alert alert-warning" role="alert" id="invalid_unameDiv" hidden>Cannot be blank!</div>
            <input type="username" class="form-control" id="uname" aria-describedby="usernameHelp" placeholder="BeefyUnicorn" oninput="notBlank('uname', true), enableBtn()">
          </div>
          <div class="form-group" id="firstNameDiv" hidden>
            <label for="firstName" id="firstNameLbl">*First Name</label>
            <div class="alert alert-warning" role="alert" id="invalid_firstNameDiv" hidden>Cannot be blank!</div>
            <input type="given-name" class="form-control" id="firstName" aria-describedby="usernameHelp" placeholder="Ted" oninput="notBlank('firstName', true), enableBtn()">
          </div>
          <div class="form-group" id="lastNameDiv" hidden>
            <label for="lastName" id="lastNameLbl">*Last Name</label>
            <div class="alert alert-warning" role="alert" id="invalid_lastNameDiv" hidden>Cannot be blank!</div>
            <input type="family-name" class="form-control" id="lastName" aria-describedby="usernameHelp" placeholder="Mosby" oninput="notBlank('lastName', true), enableBtn()">
          </div>
          <div class="form-group" id="emailDiv" hidden>
            <label for="email">*Email address</label>
            <div class="alert alert-warning" role="alert" id="invalid_emailDiv" hidden>Please put in a valid Email (Example@email.com).</div>
            <input type="email" class="form-control" id="email" aria-describedby="emailHelp" placeholder="example@email.com" oninput="validEmail(true), enableBtn()"/>
          </div>
          <div class="form-group" id="password1Div">
            <label for="password1" id="password1Lbl">Password</label>
            <div class="alert alert-warning" role="alert" id="invalid_password1Div" hidden>Cannot be blank!</div>
            <input type="password" class="form-control" id="password1" rows="1" placeholder="**********" oninput="notBlank('password1', true), enableBtn()"/>
          </div>
          <div class="form-group" id="retypeDiv" hidden>
            <label for="retype">*Re-type Password</label>
            <div class="alert alert-warning" role="alert" id="invalid_retypeDiv" hidden>Passwords are not the same!</div>
            <input type="password" class="form-control" id="retype" rows="1" placeholder="**********" oninput="isEqual('password1', 'retype', true), enableBtn()">
          </div>
          <button type="button" class="btn btn-primary" id="loginBtn" onclick="login()" disabled>Login</button>
          <button type="button" class="btn btn-success" onclick="createAccount()" id ="createBtn">Create Account</button>
        </form>
      </div>
    </div>
  </body>

<script>
  function login()
  {
    if(notBlank('uname', false) == true && notBlank('password1', false) == true)
    {
      var uname = document.getElementById("uname").value;
      var pswd = document.getElementById("password1").value;
      var checkAccount = {uname, pswd};
      if(checkAccount != null)
      {
        //Check if valid account.
        //Redirect Somewhere.
      }
      console.log(account);
    }
  }

  function createAccount(uname, firstName, lastName, email, pswd)
  {
    if(notBlank('uname', false) == true && notBlank('firstName', false) == true && notBlank('lastName', false) == true && validEmail(false) == true && isEqual('password1', 'retype', false) == true)
    {
      var uname = document.getElementById("uname").value;
      var firstName = document.getElementById("firstName").value;
      var lastName = document.getElementById("lastName").value;
      var email = document.getElementById("email").value;
      var pswd = document.getElementById("password1").value;
      var promise = sha512(uname + pswd)
      var account = [];
      account[1] = email;
      account[2] = firstName;
      account[3] = lastName;
      promise.then(function(digest)
      {
        // We transform the string into an arraybuffer
        console.log(digest);
        var uid = digest.toString();
        return account[0] = uid;
      }); // outputs one combined hashsum of username and password

      console.log(account[1].typeof)
      console.log(account);
      //Create the account somehow.
    }
    document.getElementById("emailDiv").removeAttribute("hidden");
    document.getElementById("retypeDiv").removeAttribute("hidden");
    document.getElementById("firstNameDiv").removeAttribute("hidden");
    document.getElementById("lastNameDiv").removeAttribute("hidden");
    document.getElementById("unameLbl").innerHTML="*Username";
    document.getElementById("password1Lbl").innerHTML="*Password";
    document.getElementById("loginBtn").innerHTML="I already have an account.";
    document.getElementById("loginBtn").setAttribute("class", "btn btn-link");
    document.getElementById("loginBtn").setAttribute("onClick", "goBack()");
    document.getElementById("loginBtn").removeAttribute("disabled");
    document.getElementById("createBtn").setAttribute("disabled", "");
  }
  function goBack()
  {
    document.getElementById("emailDiv").setAttribute("hidden", "");
    document.getElementById("retypeDiv").setAttribute("hidden", "");
    document.getElementById("firstNameDiv").setAttribute("hidden", "");
    document.getElementById("lastNameDiv").setAttribute("hidden", "");
    document.getElementById("unameLbl").innerHTML="Username";
    document.getElementById("password1Lbl").innerHTML="Password";
    document.getElementById("loginBtn").innerHTML="Login";
    document.getElementById("loginBtn").setAttribute("class", "btn btn-primary");
    document.getElementById("loginBtn").setAttribute("onClick", "")
  }
  function enableBtn()
  {
    //if(notBlank('uname', false) == true && notBlank('firstName', false) == true && notBlank('lastName', false) == true && validEmail(false) == true && isEqual('password1', 'retype', false) == true)
    if(notBlank('uname', false) == true)
    {
      console.log("Success!");
      document.getElementById("createBtn").removeAttribute("disabled");
      return true;
    }
    if(notBlank('uname', false) == true && notBlank('password1', false) == true)
    {
      document.getElementById("loginBtn").removeAttribute("disabled");
    }
  }
</script>

<!-- validInput.js -->
<script src="./validInput.js"></script>

<!-- Dependencies at bottom for faster load time -->


</html>
